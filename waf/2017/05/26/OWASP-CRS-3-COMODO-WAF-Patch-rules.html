<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Fools Of Security are Information Security Enthusiast. We are an Open Source Knowledge sharing platform Relating to Information security and its advancements.">
  <meta name="author" content="Fools Of Security">
  <meta name="keywords" content="">
  <link rel="canonical" href="/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html">
  <title> Fools Of Security&ensp;| FOS-OWASP CRS 3 and COMODO WAF Patch rules</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/css/grayscale.css" rel="stylesheet"><!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/rrssb.css" />
  <link rel="stylesheet" href="/css/custom.css" />
  <meta name="theme-color" content="#000000">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#000000">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
<!-- Syntax highlight in post pages -->
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/monokai_sublime.min.css"></head>
<body>
<nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button><a class="navbar-brand" href="/"><div><img src="/img/fos-border.ico" alt=""> Fools Of Security
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav"><!-- Blog, Post, Tag and Error pages --><li><a href="/#about"> About </a></li><li><a href="/blog/"> Blog </a></li><li><a href="/video/"> Video </a></li><li><a href="/#timeline"> Timeline </a></li><li><a href="/project/"> Project </a></li><li><a href="/#contact"> Contact </a></li></ul>
    </div>
  </div>
</nav>

<section id="post" class="container content-section text-center">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1><strong>FOS-OWASP CRS 3 and COMODO WAF Patch rules</strong></h1>
          <h4>
            <strong>26 May 2017</strong>
            <small>
              . category:
              <a class="category" href="/categories/waf.html">
                waf
              </a>.
              <a href="/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html#disqus_thread">Comments</a>
              <br /><a class="tag" href="/tags/tutorial.html">#tutorial</a></small>
          </h4>

          <section class="text-justify">
            <p><img src="https://cloud.githubusercontent.com/assets/22318677/26484647/f8728c7c-4210-11e7-822d-7d3a19ca95e5.jpg" alt="picsart_05-26-12 42 26" /></p>
<h3 id="how-to-write-custom-waf-rule-to-block-new-attacks-on-web-application">How to write Custom WAF rule to block new attacks on web application?</h3>
<ol>
  <li>At first, try to identify the security issue i.e payload or process which normally  WAF failed to detect.</li>
  <li>Based on that develope regex pattern to match that payload.</li>
  <li>Follow the modsecurity syntax to  write a new rule.</li>
  <li>Save the rule as .conf and include in the default rules directory.</li>
  <li>Restart the Apache server and start testing the WAF rules.</li>
</ol>

<h3 id="security-issue-overview">Security Issue Overview:</h3>
<p>When i started testing normal injection technique on both OWASP CRS 3 &amp; Comodo WAF Ruleset  separately with vulnerable app i.e <a href="https://github.com/Audi-1/sqli-labs">SQLI-LABS</a>, WAF works well. But when I tried injection payloads with different encoding techniques i.e Base64,urlencoded  (any other encoding method that support on application back-end) , it failed to detect  which lead to all possible injection attack.</p>

<h3 id="demo-waf-rule-writing">Demo WAF rule Writing</h3>

<p>1.Start testing the WAF rule i.e Comodo free WAF rules or OWASP crs rules with vulnerable web application and identifying the security issue in their rules.</p>

<p>2.While testing the OWASP CRS 3 &amp;  Comodo WAF rules, I  have found  some loop hole which allow user to bypass sql injection rules. i.e OWASP CRS &amp; Comodo Rules failed to detect base64 encoded payload or anyother encoding method that works on the application back-end.</p>

<p>3.Let see why ? OWASP CRS 3 and Comodo WAF rule does include rules to detect base64 encoded payloads.</p>

<p><strong>Demo Video :Testing OWASP CRS 3 &amp; Comodo WAF rules</strong></p>

<p><a href="https://www.youtube.com/watch?v=_CgNY9u94LU"><img src="https://img.youtube.com/vi/_CgNY9u94LU/0.jpg" alt="Alt text" /></a></p>

<p>4.These are the following payload which OWASP CRS 3 &amp;&amp; comodo WAF rules failed to detected. <br /></p>

<p><code class="highlighter-rouge">Normal Payload in base64 encoding:</code></p>

<p><strong>admin’) order by 3# :- YWRtaW4nKSBvcmRlciBieSAzIw==  <br /> 
 -admin’) union select 1,2,3# :- LWFkbWluJykgdW5pb24gc2VsZWN0IDEsMiwzIw== <br />
 -admin’) union select 1,database(),3# :-<br />
  LWFkbWluJykgdW5pb24gc2VsZWN0IDEsZGF0YWJhc2UoKSwzIwo= <br />
 -admin’) union select 1,group_concat(username),group_concat(password) from users# :- <br />      LWFkbWluJykgdW5pb24gc2VsZWN0IDEsZ3JvdXBfY29uY2F0KHVzZXJuYW1lKSxncm91cF9jb25jYXQocGFzc3dvcmQpIGZyb20gdXNlcnMj</strong></p>

<p>5.Start writing regex to match the payload
6.Fixing the identified security issue  bywriting custom WAF rule.</p>

<p><strong>Demo Video :Writing  custom rule to block above mentioned payloads using regex expression</strong></p>

<p><a href="https://www.youtube.com/watch?v=e248UPpkca0"><img src="https://img.youtube.com/vi/e248UPpkca0/0.jpg" alt="Alt text" /></a></p>

<h3 id="useful-links">Useful links:</h3>
<ol>
  <li><a href="www.modsecurity.com/">Modsecurity</a></li>
  <li><a href="https://www.kali.org/">Kali</a></li>
  <li><a href="https://www.debuggex.com/">Debuggex</a></li>
  <li><a href="https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project">OWASP Mutillidae Vulnerable App</a></li>
  <li><a href="https://github.com/Audi-1/sqli-labs">SQLi LABS</a></li>
</ol>

          </section>
          <br><div class="sharing">
    <br/>
    <br/>
    <ul>
        <li><i class="fa fa-share-square-o"></i></li>
        
        <li><a href="mailto:?subject=FOS-OWASP CRS 3 and COMODO WAF Patch rules&body=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html" rel="nofollow" target="_blank" title="Share on Email">
                <i class="fa fa-envelope-square"></i>
        </a></li>
        
        
        <li><a href="http://www.linkedin.com/shareArticle?url=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html&title=FOS-OWASP CRS 3 and COMODO WAF Patch rules" rel="nofollow" target="_blank" title="Share on LinkedIn">
                <i class="fa fa-linkedin-square"></i>
        </a></li>
        
        
        <li><a href="https://twitter.com/intent/tweet?text=FOS-OWASP CRS 3 and COMODO WAF Patch rules&url=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html" rel="nofollow" target="_blank" title="Share on Twitter">
                <i class="fa fa-twitter-square"></i>
        </a></li>
        
        
        <li><a href="https://facebook.com/sharer.php?u=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html" rel="nofollow" target="_blank" title="Share on Facebook">
                <i class="fa fa-facebook-square"></i>
        </a></li>
        

        
        <li><a href="https://plus.google.com/share?url=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html" rel="nofollow" target="_blank" title="Share on Google+">
                <i class="fa fa-google-plus-square"></i>
        </a></li>
        

        
        <li><a href="http://reddit.com/submit?url=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html&title=FOS-OWASP CRS 3 and COMODO WAF Patch rules" rel="nofollow" target="_blank" title="Share on Reddit">
                <i class="fa fa-reddit-square"></i>
        </a></li>
        
        
        <li><a href="https://pinterest.com/pin/create/button/?url=http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html" rel="nofollow" target="_blank" title="Share on Pinterest">
                <i class="fa fa-pinterest-square"></i>
        </a></li>
        
    </ul>
</div>
<br/>
<br/><div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><hr /><div class="author row">
            <img class="col-xs-4 col-sm-3 col-md-2" src="/img/author.png" alt="Me" />
            <p class="col-xs-8 col-sm-9 col-md-10">
              Umar Farook is an Security Researcher & AppSec Enthusiast. He always approach App Security with innovative ideas  to explore and prevent Modern web application attacks. In spare time, he work on scrapying data from website and automating AppSec with Python.
            </p>
          </div></div>
      </div>
    </section>
<footer>
    <br>
<ul class="list-inline social-buttons"><li><a href="https://github.com/umarfarook882" target="_blank"><i class="fa fa-github fa-fw"></i></a></li><li><a href="https://www.youtube.com/channel/UCEBHO0kD1WFvIhf9wBCU-VQ" target="_blank"><i class="fa fa-youtube-play fa-fw"></i></a></li><li><a href="http://fosecurity.blogspot.in/" target="_blank"><i class="fa fa-globe fa-fw"></i></a></li></ul>

<p><br></p>
    <div class="container text-center">
        <p>Copyright &copy; Fools Of Security 2017</p><p style="font-size: 16px;"><a href="https://zerobin.net/?f1744fd662ccc911#AknpWQMXs3ZSDTvvgLTD67W7D9PrlI5vv06zDDG217I=" target="_blank"><i
                class="fa fa-key"></i> Fools of Security via PGP</a></p></div>
</footer>

<!-- Javascript Start -->
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript">
    var disqus_shortname = 'foolsofsecurity-com';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
  <script src="/js/rrssb.min.js"></script><script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, 'FOS-OWASP CRS 3 and COMODO WAF Patch rules', 'http://foolsofsecurity.com/waf/2017/05/26/OWASP-CRS-3-COMODO-WAF-Patch-rules.html');
  }
}
</script>

<!-- Javascript End -->
</body>
</html>

